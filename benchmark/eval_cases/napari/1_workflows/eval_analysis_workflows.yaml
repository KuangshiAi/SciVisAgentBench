# Analysis Workflow Tests for napari-mcp
# These tests evaluate complex analysis workflows that combine multiple napari functions
# Each test focuses on performing specific analysis tasks

# Test: Cell Counting and Measurement Analysis
- vars:
    question: |
      Load the image "data/dataset_001/dataset_001.tiff" and set it to magenta colormap.
      Take a screenshot and analyze it to count how many complete cells are visible (not cut off by edges).
      Add point annotations to mark the center of each counted cell.
      Measure the distance between the two most distant cells.
      Q1: answer with the number of complete cells you counted, for example "5" if you see 5 complete cells.
      Save the answer of Q1 to the questions in plain text as "eval_analysis_workflows/Q1_answer.txt".
  assert:
    - type: llm-rubric
      subtype: text
      value: |
        1. Q1 correct answer: 2
      rs-file: eval_analysis_workflows/Q1_answer.txt
  options:
    cache: false
    runSerially: true

# Test: Statistical Analysis and Data Export
- vars:
    question: |
      Get basic statistics (min, max, mean, std) for the loaded layer.
      Extract the raw layer data and examine its properties.
      Save the current layer to a file for further analysis.
      Export a screenshot of the current view for documentation.
      Respond with <1> if the statistical analysis and data export were successful, or <0> if it failed. Only respond with <1> or <0>.
  assert:
    - type: contains-all
      value: "<1>"
    - type: not-contains
      value: "<0>"
  options:
    cache: false
    runSerially: true

# Test: Annotation and Measurement Workflow
- vars:
    question: |
      1. Add point annotations to mark specific features of interest in the image.
      2. Add shape annotations (rectangles or circles) to highlight regions of interest.
      3. Measure distances between multiple pairs of points.
      4. Take a screenshot showing all annotations and measurements, save it to "eval_analysis_workflows/screenshot_1.png".
  assert:
    - type: llm-rubric
      value: |
          1. The screenshot shows the point and shape annotations, and measurements
      rs-file: eval_analysis_workflows/screenshot_1.png
  options:
    cache: false
    runSerially: true

# Test: Time Series Analysis (if applicable)
- vars:
    question: |
      If the data has time dimensions, navigate through different time points.
      Compare cellular structures between different time points.
      Take screenshots at different time points to show temporal changes.
      If no time dimension exists, simulate time series analysis by adjusting the current view and taking multiple screenshots.
      Respond with <1> if the time series analysis was successful, or <0> if it failed. Only respond with <1> or <0>.
  assert:
    - type: contains-all
      value: "<1>"
    - type: not-contains
      value: "<0>"
  options:
    cache: false
    runSerially: true

# Test: Data Cropping and Region of Interest Analysis
- vars:
    question: |
      1. Define a region of interest by cropping the layer to a specific area.
      2. Analyze the cropped region separately from the full dataset.
      3. Compare statistics between the full dataset and the cropped region.
      4. Take a screenshot of the full view and save it to "eval_analysis_workflows/screenshot_2.png".
      5. Take a screenshot of the cropped region and save it to "eval_analysis_workflows/screenshot_3.png".
  assert:
    - type: llm-rubric
      subtype: vision
      value: |
          1. This screenshot shows the full dataset with the cropped region highlighted.
      rs-file: eval_analysis_workflows/screenshot_2.png
  options:
    cache: false
    runSerially: true

# Test: Cleanup - Reset for next test run
- vars:
    question: |
      Delete all loaded layers and remove any annotations to prepare for the next test run.
      Respond with <1> if all layers and annotations were successfully removed, or <0> if it failed. Only respond with <1> or <0>.
  assert:
    - type: contains-all
      value: "<1>"
    - type: not-contains
      value: "<0>"
  options:
    cache: false
    runSerially: true